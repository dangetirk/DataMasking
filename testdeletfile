import pandas as pd
from faker import Faker
import os
import random
import configparser
import sys
import logging
from datetime import datetime
import csv

# ... [Other parts of your script, such as logger setup, fake data generators, etc.] ...

def process_config_entries(config_entries, input_dir, mask_folder):
    path = os.getcwd()

    for entry in config_entries:
        src_file = entry['src_file']
        column_mappings = entry['columns']
        src_folder = entry['src_folder']

        output_dir = os.path.join(path, mask_folder, src_folder)
        os.makedirs(output_dir, exist_ok=True)

        input_file_path = os.path.join(input_dir, src_folder, src_file)

        if not os.path.isfile(input_file_path):
            logger.warning(f"The file '{input_file_path}' does not exist. Skipping this file.")
            continue

        # Increase the CSV field size limit
        csv.field_size_limit(sys.maxsize)

        with open(input_file_path, 'r', newline='') as file:
            reader = csv.reader(file, delimiter='|', quoting=csv.QUOTE_ALL, escapechar='\\')
            lines = list(reader)

        header = '|'.join(lines[0]) + '\n'
        footer = '|'.join(lines[-1]) + '\n'
        body_lines = lines[1:-1]

        # Convert list of lists to a DataFrame
        body = pd.DataFrame(body_lines, dtype=str)

        column_mappings = dict(column.split('=') for column in column_mappings.split(','))

        body = replace_columns_with_fake_data(body, column_mappings)
        body = body.applymap(lambda x: x.replace("|", ",").replace("\n", " ") if isinstance(x, str) else x)

        csv_body = body.to_csv(index=False, sep='|', header=False, quoting=csv.QUOTE_NONE, quotechar="", escapechar="\\")

        with open(output_file, 'w', newline='\n') as file:
            file.write(header)
            file.write(csv_body)
            file.write(footer)

        logger.info(f"Masked file saved to {output_file}")

# ... [Rest of your script, including the main execution block] ...
